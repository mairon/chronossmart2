<div class="c-detail-header">
   <nav class="c-breadcrumb c-breadcrumb--opened">
      <div class="c-breadcrumb__funnel">
        <%= link_to crm_pipeline_path(@negocio.etapa.pipeline_id) do %>
          <svg xmlns="http://www.w3.org/2000/svg" height="20px" viewBox="0 -960 960 960"  fill="#6d758d" style="padding-top: 6px;display: inline-table;"><path  d="M384-264v-72h192v72H384ZM240-444v-72h480v72H240Zm-96-180v-72h672v72H144Z"/></svg>
          <span>
            <%= @negocio.etapa.pipeline.nome %>
          </span>
        <% end %>
      </div>
      <% @etapas.each do |e| %>
        <% if e.id == @negocio.etapa_id %>
          <div class="c-breadcrumb__stage c-breadcrumb__stage--active">            
            <span class="c-breadcrumb__stage__shape"></span><span class="c-breadcrumb__stage__name">
              <svg xmlns="http://www.w3.org/2000/svg" height="15px" viewBox="0 -960 960 960" width="20px" fill="#31304c"><path d="M480.21-480Q510-480 531-501.21t21-51Q552-582 530.79-603t-51-21Q450-624 429-602.79t-21 51Q408-522 429.21-501t51 21ZM480-96Q323.03-227.11 245.51-339.55 168-452 168-549q0-134 89-224.5T479.5-864q133.5 0 223 90.5T792-549q0 97-77 209T480-96Z"/></svg>              
              <%= e.nome %></span>
          </div>
        <% else %>
          <div class="c-breadcrumb__stage etapa_oportunidade" data-box-id="<%= e.id %>">
            <span class="c-breadcrumb__stage__shape"></span><!----><span class="c-breadcrumb__stage__name"><%= e.nome %></span>
          </div>              

        <% end %>
      <% end %>
   </nav>
   <div class="c-stage-status" align="center">
      <% if @negocio.status.to_i == 0 %>
      <button class="c-button--flat mdc-button__icon mdc-button c-stage-status__button c-stage-status__button__won mdc-ripple-upgraded" id="entity-breadcrumb-button-won" >
         <!----><span class="c-text us" style="font-size: 10px;"><%= t('win') %></span>
          <i class="c-icon material-icons c-icon--moskit-icon moskit-icon-thumb-up-outline" style="margin-top:12px">
          <svg xmlns="http://www.w3.org/2000/svg" height="18px" viewBox="0 -960 960 960" width="18px" fill="#6d758d"><path d="M292-120v-66.67h154.67v-140q-52.34-11-93.17-44.83T296-456q-74.33-8.33-125.17-61.83Q120-571.33 120-645.33V-688q0-27.67 19.5-47.17t47.17-19.5h96V-840h394.66v85.33h96q27.67 0 47.17 19.5T840-688v42.67q0 74-50.83 127.5Q738.33-464.33 664-456q-16.67 50.67-57.5 84.5t-93.17 44.83v140H668V-120H292Zm-9.33-406.67V-688h-96v42.67q0 42.66 27 75.16t69 43.5ZM480-390q54.67 0 92.67-38.33 38-38.34 38-93v-252H349.33v252q0 54.66 38 93Q425.33-390 480-390Zm197.33-136.67q42-11 69-43.5t27-75.16V-688h-96v161.33ZM480-582Z"/></svg>           
         </i>
      </button>
      <button class="c-button--flat mdc-button__icon mdc-button c-stage-status__button c-stage-status__button__lost mdc-ripple-upgraded" id="entity-breadcrumb-button-lost">
         
         <!----><span class="c-text gs" style="font-size: 10px; "><%= t('lost') %></span><i class="c-icon material-icons c-icon--moskit-icon moskit-icon-thumb-down-outline" style="margin-top:6px">
          <svg xmlns="http://www.w3.org/2000/svg" height="18px" viewBox="0 -960 960 960" width="18px" fill="#6d758d"><path d="M733.33-439.33V-800H800v360.67h-66.67ZM160-160v-640h66.67v640H160Zm286.67-488.67V-800h66.66v151.33h-66.66Zm0 244V-556h66.66v151.33h-66.66Zm0 244.67v-152h66.66v152h-66.66ZM635-129.67 719.33-214l-85-84.67L682-346.33l84.67 85 84.66-85 47.34 47.66L814.33-214l84 84.67-47 47.33-84.66-85-85 85L635-129.67Z"/></svg>           
         </i>
      </button>
      <% else %>
      <button id="entity-breadcrumb-button-reabri">
         
         <!----><span class="c-text" style="font-size: 14px; " >Reabri</span><i class="c-icon material-icons c-icon--moskit-icon moskit-icon-thumb-down-outline" style="margin-top:6px">
          
         </i>
      </button>      
      <% end %>

      <!---->
   </div>
</div>

<script>
  $(".etapa_oportunidade").click(function(){
    $.ajax({
      type: "POST",
      url: "/crm/negocios/draggable",
      data: {
        "deal_id": <%= @negocio.id %>,
        "origin_step_id": <%= @negocio.etapa_id %>,
        "step_id": $(this).attr("data-box-id")
      }, success: function(){
        location.reload()
      }
    });       

  })
</script>


<script>
  $("#entity-breadcrumb-button-won").click(function(){
    $.ajax({
      type: "POST",
      url: "/crm/negocios/update_status",
      data: {
        "status": '1',
        "id": <%= @negocio.id %>
      }, success: function(){
        location.reload()
      }
    });       

  })
</script>

<script>
  $("#entity-breadcrumb-button-won").click(function(){
    $.ajax({
      type: "POST",
      url: "/crm/negocios/update_status",
      data: {
        "status": '1',
        "id": <%= @negocio.id %>
      }, success: function(){
        location.reload()
      }
    });       

  })
</script>

<script>
  $("#entity-breadcrumb-button-reabri").click(function(){
    $.ajax({
      type: "POST",
      url: "/crm/negocios/update_status",
      data: {
        "status": '0',
        "id": <%= @negocio.id %>
      }, success: function(){
        location.reload()
      }
    });       

  })
</script>

<script>
  $("#entity-breadcrumb-button-lost").click(function(){
    $.ajax({
      type: "POST",
      url: "/crm/negocios/update_status",
      data: {
        "status": '2',
        "id": <%= @negocio.id %>
      }, success: function(){
        location.reload()
      }
    });       

  })
</script>